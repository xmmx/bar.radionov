$((function(){let e,t={},a={type:"cocktails",basedOn:[],without:[]},n=[];const s=$("<div>").addClass("card-badge"),d=$("<span>").addClass("tag"),l=$("#cardsContainer"),c=$("#tagContainer-basedOn"),o=$("#tagContainer-without"),i=(e,a)=>{let n=0,s=0,d=0;Object.keys(e.ingridients).forEach((a=>{const l=e.ingridients[a];let c=t[a];if(!c)return alert(`Not found "${a}"`),!1;c.ingridients&&(c={...c,...i(c,!0),unitType:"мл"}),"мл"==c.unitType?(n+=l,c.alc&&(s+=l*c.alc/100)):"сахар"==a&&(n+=.6*l),d+=l*c.price}));const l=(s/n*100).toFixed(0);return a&&(d/=n),d=d.toFixed(0),{alc:l,value:n.toFixed(0),price:d}},r=(e,t)=>{const n=e.children().filter(((e,n)=>!a[t].includes($(n).text()))).sort(((e,t)=>$(t).text>$(e).text()));e.html("").append(n)},p={stir:"refresh",shake:"swap_vert",layers:"table_rows",blend:"blender",hot:"local_fire_department"};let h=0;const g=(e,l)=>{const r=h%4+1,g=$("<article/>").addClass(`card surface${r}`),u=[],b=i(l),m=b.alc||l.alc;m&&u.push(s.clone().addClass("alcohol").html(`${m}&deg;`)),b.value&&u.push(s.clone().html(`${b.value}ml`)),b.price&&u.push(s.clone().html(`${b.price}₽`)),l.color&&u.push(s.clone().css("backgroundColor",l.color).html("&nbsp;&nbsp;&nbsp;")),l.method&&u.push($("<span>").css({float:"right",fontSize:"24px"}).addClass("icon-asset material-symbols-outlined").html($("<span>").text(p[l.method])));const f=$('<div class="card-front">'),x=$('<div class="card-back">'),C=l.img?`/img/${e.toLowerCase().replace(/\s/g,"_")}.jpg`:"https://via.placeholder.com/450";return f.append($("<div>").append(u)).append($("<br/>")).append($("<img/>").addClass("img-cover").attr("src",C).attr("alt",e).attr("loading","lazy").attr("decoding","async").attr("width","100%").attr("height","200px")).append($("<h3>").text(e)),x.append($("<p>").append((e=>{const a=[];return Object.keys(e).sort(((t,a)=>e[a]-e[t])).map((n=>{t[n];const s=e[n];a.push($('<ol class="list-outside">').append($("<li>").attr("value",s).text(n)))})),a})(l.ingridients))).append($("<p>").html(l.recepie.length>1?$("<p>").append(l.recepie.map((e=>$("<div>").css("paddingBottom",8).text(e)))):l.recepie)),g.append($('<div class="card-inner">').append([f,x])),Object.keys(l.ingridients).forEach((e=>{n.includes(e)||(n.push(e),c.append(d.clone().text(e).addClass("based-on")),a.basedOn.includes(e)||o.append(d.clone().text(e).addClass("without")))})),h++,g},u=()=>{dialog.close(),$("#dialog-container").html(""),l.html(""),c.html(""),o.html(""),n=[];const t=e[a.type];Object.keys(t).filter((e=>{let n=!0;const s=Object.keys(t[e].ingridients);return a.without.length&&s.forEach((e=>{a.without.includes(e)&&(n=!1)})),n&&a.basedOn.length&&a.basedOn.forEach((e=>{s.includes(e)||(n=!1)})),n})).forEach((e=>{l.append(g(e,t[e]))}));const s=l.children().sort(((e,t)=>(e=parseInt($(e).find(".alcohol").text()))-(t=parseInt($(t).find(".alcohol").text()))));l.html("").append(s),$(".card").click((e=>{$(e.currentTarget).toggleClass("flipped")})),r(c,"basedOn"),r(o,"without"),a.without.forEach((e=>{o.prepend(d.clone().text(e).addClass("without selected"))})),a.basedOn.forEach((e=>{c.prepend(d.clone().text(e).addClass("based-on selected"))})),$(".tag").click((e=>{const t=$(e.currentTarget),n=t.hasClass("without")?"without":"basedOn",s=t.text();t.hasClass("selected")?a[n]=$.grep(a[n],(e=>e!=s)):(a[n].push(s),t.addClass("selected")),u()}))};let b;$.getJSON("./data/data.json",(a=>{e=a,t={...e.ingridients,...e.complexIngridients,...e.liquors},u()})),$(".btn-change-type").click((e=>{$(".btn-change-type").prop("disabled",!1);const t=$(e.currentTarget);a.type=t.attr("data-rel"),t.prop("disabled",!0),u()})),$("#btn-without-enabled, #btn-show-based-on").click((e=>{b=$(e.currentTarget).attr("for"),$(b).children().prependTo($("#dialog-container")),dialog.showModal()})),dialog.addEventListener("close",(e=>{$("#dialog-container").children().prependTo($(b))})),$("#dialog-close").click((()=>{dialog.close()}))}));
